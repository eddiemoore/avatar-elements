<script>
(function() {
    var element = Object.create(HTMLImageElement.prototype);

    element.createdCallback = function() {
        var self = this;
        var username = this.getAttribute('username');
        var url = 'https://api.github.com/users/' + username;

        loadJSON(url, function(data) {
            self.setAttribute('src', data.avatar_url);
		});
    };

    document.registerElement('avatar-github', {
        prototype: element,
        extends: 'img'
    });
}());

function loadJSON(path, callback) {
	var httpRequest = new XMLHttpRequest();
	httpRequest.onreadystatechange = function() {
		if (httpRequest.readyState === 4) {
			if (httpRequest.status === 200) {
				var data = JSON.parse(httpRequest.responseText);
				if (callback) callback(data);
			}
		}
	};
	httpRequest.open('GET', path, true);
	httpRequest.send();
}
</script>
